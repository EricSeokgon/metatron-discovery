= metatron Application Configuration Guide
metatron.app;
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 4
:sectlinks:

[[overview]]
= Overview

The metatron application configuration is configured in yaml format.
The "application-config.templete.yaml" file provided by the distribution binary is provided as an example, and you can specify detailed settings based on the information below.

[[common-properties]]
== Common Properties

Common properties in metatron depends on the spring boot configuration. Therefore, if you need additional settings, please refer to the https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/html/common-application-properties.html[link].

[source, yaml]
----
spring:
  http:
    multipart: # Used to adjust the maximum size when uploading files
      max-file-size: 300Mb
      max-request-size: 300Mb
  # The data source used by the application has the following default settings. 
  # If you want additional configuration, it is recommended to manage only connection pool or jpa related properties.
  datasource:
    platform: mysql
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/polaris_v2?useUnicode=true&amp;characterEncoding=utf8
    username: polaris
    password: polaris
    # Below is the connection pool related configuration.
    max-active: 50
    max-idle: 10
    min-idle: 10
    initial-size: 10
    test-on-borrow: false
    test-on-return: false
    test-while-idle: true
    max-wait: 1000
    validation-query: SELECT 1
  jpa:
    show-sql: false
    properties:
      hibernate:
        jdbc:
          batch_size: 25
        order_inserts: true
        order_updates: true
        dialect: org.hibernate.dialect.MySQL5InnoDBDialect
server:
  port: 8180 # If you want to change the port
  tomcat:
    ajp: # You can allow ajp connection with the following settings.
      enabled: false
      protocol: AJP/1.3
      port: 8280
logging: 
  # If you want to set up a separate log, create a separate file to specify the path to the file.
  # Please refer to https://logback.qos.ch/manual/configuration.html
  config: classpath:logback-console.xml
  mail: # Mail(SMTP) server properteis
    host: localhost
    port: 25
    username:
    password:
----

[[app-properties]]
== Application Properties

The application-related properties are prefixed with "polaris" and categorized by domain.

[source, yaml]
----
polaris:
  format: 
    datetimes: # Specify a datetime format that is recommended when performing validation on a column of type timestamp.
      - 'yy-MM-dd'
      - 'dd/MM/yyyy'
  storage:
    # The stagedb concept is internally used as an intermediary processing medium when processing large amounts of 
    # data when ingesting or trasforming data in an application. We are using hive and specify the information related to it.
    stagedb: 
      hostname: localhost # for hiveserver
      port: 10000         # for hiveserver
      username: hive      # for hiveserver
      password: hive      # for hiveserver
      metastore: # specify additional information when you want to get more information such as partitions.
        uri: thrift://localhost:9083
        jdbc:
          url: jdbc:mysql://metatron-web-01:3306/hive
          username: hive
          password: hive
  engine:
    hostname: # Specify representative access url by engine node, application requires only 3 nodes
      broker: http://localhost:8082
      overlord: http://localhost:8090
      coordinator: http://localhost:8081
    ingestion:
      loader: # Used when forwarding files from an application to an engine cluster when loading local files
        remoteType: SSH # "LOCAL" is the default value, but if the engine is configured as a separate cluster, use "SSH" mode for remote communication.
        localBaseDir: ${java.io.tmpdir:-/tmp}
        remoteDir: ${java.io.tmpdir:-/tmp}
        hosts: # Specifies the host information where the middle manager node is located.
          middlemanager01: # It must be the hostname recognized by the engine. Refer to the worker hostname on the engine console.
            port: 22
            username: metatron
            password: pem:${METATRON_HOME}/pem/user-metatron.pem # Specify "pem" prefix and pem file location if you use pem file when connecting to remote host
          "[middlemanager.01]": # If the host name contains "." If included, display like this
            port: 22
            username: metatron
            password: metatron_password
    query:
      loader: # Unlike in "ingestion", when downloading query results, it is used to transfer download file generated by engine to application
        remoteType: LOCAL
        localBaseDir: ${java.io.tmpdir:-/tmp}
  datasource:
    ingestion:
      retries: # Retry properties used when checking the status of engine when ingestion
        delay: 3
        maxDelay: 90
        maxDuration : 3600
  mail: # Additional information for mail notifications
    admin: admin@metatron.com # Specify representative manager email
    baseUrl: http://localhost:8180 # Specify connection url for linking metatron contents in mail
  workbench:
    defaultResultSize: 1000
    maxResultSize: 1000000
    maxFetchSize: 1000
    tempHdfsPath: /tmp/hive
    tempCSVPath: /tmp
  dataprep:
    localBaseDir: ${user.home}/dataprep
    hadoopConfDir: /etc/hadoop
    stagingBaseDir: hdfs://localhost:9000/user/hive/dataprep
    sampling:
      timeout: 20
    etl:
      timeout: 36000
----

